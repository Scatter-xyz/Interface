(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[949],{3976:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/merge",function(){return c(9586)}])},9586:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return u}});var d=c(7568),e=c(1799),f=c(9396),g=c(4051),h=c.n(g),i=c(5893),j=c(8019),k=c(7294);c(3678);var l=c(6076),m=c(3609),n=c(2224),o=JSON.parse('[{"inputs":[{"internalType":"string","name":"uri_","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}]'),p=new Headers;function q(a){return JSON.stringify({query:"{\n  tokens(first: 20) {\n    id\n    tokenId\n    owner\n    fractionContract\n    tokenURI\n originalContract\n    fractionCount\n  }\n}\n",variables:{}})}p.append("content-type","application/json");var r,s=function(a){var b,c,g,j=a.nftData,p=a.walletContext,q=(0,k.useState)(void 0===j?{}:j),r=q[0],s=q[1],t=(b=(0,d.Z)(h().mark(function a(){var b,c,d;return h().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=new l.CH(r.fractionAddress,o,p.provider),a.next=3,b.connect(p.signer);case 3:return c=a.sent,a.next=6,c.balanceOf(p.address,r.tokenID);case 6:return d=BigInt(d=a.sent),a.abrupt("return",d.toString());case 9:case"end":return a.stop()}},a)})),function(){return b.apply(this,arguments)}),u=(c=(0,d.Z)(h().mark(function a(){var b,c,d,e,f,g,i;return h().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(p&&!p.error)){a.next=27;break}return b=new l.CH(m.tm,n,p.provider),a.next=4,b.connect(p.signer);case 4:return c=a.sent,d=new l.CH(r.fractionAddress,o,p.provider),a.next=8,d.connect(p.signer);case 8:return e=a.sent,a.next=11,e.isApprovedForAll(r.owner,m.tm);case 11:if(f=a.sent,console.log("Approver is: ",f),f){a.next=21;break}return a.next=16,e.setApprovalForAll(m.tm,!0);case 16:g=a.sent,console.log("Transcation Receipt: ",g),g.hash,a.next=27;break;case 21:return console.log("Can merge now!"),a.next=24,c.merge(r.fractionAddress,r.tokenID);case 24:i=a.sent,console.log("Transcation Receipt: ",i),i.hash;case 27:case"end":return a.stop()}},a)})),function(){return c.apply(this,arguments)}),v=(g=(0,d.Z)(h().mark(function a(){var b,c,d;return h().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(r.nftImage.replace("ipfs://","https://ipfs.io/ipfs/"));case 2:return b=a.sent,a.next=5,b.json();case 5:return c=a.sent,d="0",p&&!p.error&&(d=t()),a.next=10,t();case 10:d=a.sent,console.log("Fraction Count: ",d),s((0,f.Z)((0,e.Z)({},r),{availableFractionCount:d,nftImage:c.image.replace("ipfs://","https://ipfs.io/ipfs/")}));case 13:case"end":return a.stop()}},a)})),function(){return g.apply(this,arguments)});return(0,k.useEffect)(function(){v()},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"rounded-lg shadow-lg bg-white w-fit mb-0",children:[(0,i.jsx)("div",{className:"m-h-60",children:(0,i.jsx)("img",{className:"rounded-t-lg h-60 w-72 md:h-60 md:w-60 lg:h-72 lg:w-72",src:r.nftImage,alt:""})}),(0,i.jsxs)("div",{className:"w-content",children:[(0,i.jsxs)("div",{className:"px-4 py-2 lg:py-4",children:[(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("p",{className:"text-emerald-700 text-sm font-semibold mb-2",children:"Original Address: "}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsxs)("a",{className:"text-sm text-emerald-900 hover:text-emerald-700",href:"https://etherscan.io/address/".concat(r.originalAddress),rel:"noreferrer",target:"_blank",children:[r.originalAddress.substring(0,2)+"..."+r.originalAddress.substring(r.originalAddress.length-4,r.originalAddress.length)," "]})]}),(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("p",{className:"text-emerald-700 text-sm font-semibold mb-2",children:"Fraction Address: "}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsxs)("a",{className:"text-sm text-emerald-900 hover:text-emerald-700",href:"https://rinkeby.etherscan.io//address/".concat(r.fractionAddress),rel:"noreferrer",target:"_blank",children:[r.fractionAddress.substring(0,2)+"..."+r.fractionAddress.substring(r.fractionAddress.length-4,r.fractionAddress.length),"  "]})]}),(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("p",{className:"text-emerald-700 text-sm font-semibold mb-2",children:"Token Id: "}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)("p",{className:"text-sm text-emerald-900",children:r.tokenID})]}),(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("p",{className:"text-emerald-700 text-sm font-semibold mb-2",children:"Fractions:"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsxs)("p",{className:"text-sm text-emerald-900",children:[r.availableFractionCount,"/",r.fractionCount," "]})]})]}),(0,i.jsx)("div",{className:"h-full w-full",children:r.availableFractionCount===r.fractionCount?(0,i.jsx)("button",{onClick:function(){return u()},className:"rounded-b-lg font-sans w-full py-4 bg-stiletto-500 hover:bg-stiletto-600 text-white font-semibold md:text-sm text-lg lg:text-xl",children:"Merge"}):(0,i.jsx)("button",{className:"rounded-b-lg font-sans w-full py-4 bg-gray-500 text-white font-semibold md:text-sm text-lg lg:text-xl",disabled:!0,children:"Insufficient Fractions"})})]})]},r.originalAddress+"-"+r.tokenID)})},t=(r=(0,d.Z)(h().mark(function a(b,c){var e,f,g;return h().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:var i;return e=[],a.next=3,fetch("https://api.thegraph.com/subgraphs/name/cpp-phoenix/scatter",(i=q(b),{method:"POST",headers:p,body:i,redirect:"follow"}));case 3:if(200!==(f=a.sent).status){a.next=11;break}return a.next=7,f.json();case 7:return g=a.sent,console.log("Data is: ",g),a.next=11,g.data.tokens.map(function(){var a=(0,d.Z)(h().mark(function a(b){return h().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:console.log("FractionCount is: ",b.fractionCount),"0"!==b.fractionCount&&(console.log("FractionCount New is: ",b.fractionCount),e.push({owner:b.owner,nftImage:b.tokenURI,originalAddress:b.originalContract,fractionAddress:b.fractionContract,tokenID:b.tokenId,fractionCount:b.fractionCount,availableFractionCount:"0",openSeaLink:m.i9+b.fractionContract+"/"+b.tokenId,id:b.id}));case 2:case"end":return a.stop()}},a)}));return function(b){return a.apply(this,arguments)}}());case 11:c(e);case 12:case"end":return a.stop()}},a)})),function(a,b){return r.apply(this,arguments)}),u=function(){var a=(0,k.useState)(),b=a[0],c=a[1],d=(0,k.useState)([]),e=d[0],f=d[1];return(0,k.useEffect)(function(){b&&!b.error&&t(b.address,f)},[b]),(0,i.jsxs)("div",{className:"w-full min-h-content bg-gin-50",children:[(0,i.jsx)(j.Z,{pageLoad:"Merge",setWalletContext:c}),(0,i.jsx)("div",{className:"pt-10 min-h-screen z-10 w-full",children:(0,i.jsx)("div",{className:"pt-20 z-0 w-full",children:(0,i.jsx)("div",{className:"flex flex-rows justify-center w-full",children:(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-6 lg:gap-10 xl:gap-12",children:e.map(function(a){return(0,i.jsx)(s,{nftData:a,walletContext:b},a.id)})})})})})]})}},2224:function(a){"use strict";a.exports=JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":true,"internalType":"address","name":"originalNftContract","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"fractionCount","type":"uint256"},{"indexed":true,"internalType":"address","name":"fractionNftContract","type":"address"},{"indexed":false,"internalType":"string","name":"tokenURI","type":"string"}],"name":"fractionaliseEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":true,"internalType":"address","name":"originalNftContract","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"fractionNftContract","type":"address"}],"name":"mergeEvent","type":"event"},{"inputs":[],"name":"MAX_FRACTION_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"destroy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_nftContractAddress","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"fractionCount","type":"uint256"}],"name":"fractionalize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"fractionAddress","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"merge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}]')}},function(a){a.O(0,[651,294,325,774,888,179],function(){var b;return a(a.s=3976)}),_N_E=a.O()}])